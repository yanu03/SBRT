<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.tracom.bms.domain.SI0503.SI0503Mapper">

<select id="SI0503G0R0" resultType="Map">
	select  CRS_ID,
			NODE_ID,
			CRS_NM,
			CRS_ENM,
			CRS_KIND,
			SIG_CTR_TYPE,
			GPS_X,
			GPS_Y,
			TM_X,
			TM_Y,
			MAIN_PHASE,
			PHASE_CNT,
			PERIOD_LEN,
			PERIOD_CNT,
			DATE_FORMAT(APPL_ST_DT, '%Y%m%d') APPL_ST_DT,
			DATE_FORMAT(APPL_ED_DT, '%Y%m%d') APPL_ED_DT,
			USE_YN,
			REMARK
			
	from BMS_CRS_MST
	
	<where>
		<if test="TYPE == 'CRS_ID'">
			AND CRS_ID LIKE CONCAT('%',#{CONTENT},'%')
		</if>
		<if test="TYPE == 'CRS_NM'">
			AND CRS_NM LIKE CONCAT('%',#{CONTENT},'%') 
		</if>
	</where>
</select>

<select id="SI0503G0K0" resultType="Map">
	SELECT CONCAT('CR', LPAD(NEXTVAL(SEQ_BMS_CRS_MST_0), 8, '0')) AS 'SEQ'
</select>

<select id="SI0503SHI0" resultType="Map">
	select CRS_ID, CRS_NM
	from BMS_CRS_MST
	order by CRS_ID
</select>

<insert id="SI0503G0I0" parameterType="Map">
    <selectKey keyProperty="NODE_ID" resultType="String" order="BEFORE">
       SELECT CONCAT('ND', LPAD(NEXTVAL(SEQ_BMS_NODE_MST_0), 8, '0'))
    </selectKey>	
	insert into BMS_CRS_MST
			(
				CRS_ID,
				NODE_ID,
				CRS_NM,
				CRS_KIND,
				SIG_CTR_TYPE,
				GPS_X,
				GPS_Y,
				APPL_ST_DT,
				APPL_ED_DT,
				USE_YN,
				REMARK,
				UPD_DTM,
				UPD_ID
			)
	
	values		
			(
				#{CRS_ID},
				#{NODE_ID},
				#{CRS_NM},
				#{CRS_KIND},
				#{SIG_CTR_TYPE},
				#{GPS_X},
				#{GPS_Y},
				STR_TO_DATE(#{APPL_ST_DT}, '%Y%m%d'),
				STR_TO_DATE(#{APPL_ED_DT}, '%Y%m%d'), 
				#{USE_YN},
				#{REMARK},
				#{UPD_DTM},
				#{SSN_USER_ID}		
			);
			
			
	insert into BMS_NODE_MST
			(
				NODE_ID,
				NODE_NM,
				NODE_TYPE,
				GPS_X,
				GPS_Y,
				USE_YN,
				UPD_DTM,
				UPD_ID		
			)
	values
			(
				#{NODE_ID},
				#{CRS_NM},
				'NT01',
				#{GPS_X},
				#{GPS_Y},
				#{USE_YN},
				#{UPD_DTM},
				#{SSN_USER_ID}				
			)
</insert>

<update id="SI0503G0U0" parameterType="Map">
	update BMS_CRS_MST
	set		CRS_NM = #{CRS_NM},
			CRS_KIND = #{CRS_KIND},
			SIG_CTR_TYPE = #{SIG_CTR_TYPE},
			GPS_X = #{GPS_X},
			GPS_Y = #{GPS_Y},
			APPL_ST_DT = STR_TO_DATE(#{APPL_ST_DT}, '%Y%m%d'),
			APPL_ED_DT = STR_TO_DATE(#{APPL_ED_DT}, '%Y%m%d'),
			USE_YN = #{USE_YN},
			REMARK = #{REMARK},
			UPD_DTM = #{UPD_DTM},
			UPD_ID = #{SSN_USER_ID}

	where CRS_ID = #{CRS_ID};
	
	update BMS_NODE_MST
	set		NODE_NM = #{CRS_NM},
			GPS_X = #{GPS_X},
			GPS_Y = #{GPS_Y},
			USE_YN = #{USE_YN},
			UPD_DTM = #{UPD_DTM},
			UPD_ID = #{SSN_USER_ID}
	where NODE_ID = #{NODE_ID}			  
</update>

<delete id="SI0503G0D0" parameterType="Map">
	delete
	from BMS_CRS_MST
	where CRS_ID = #{CRS_ID};
	
	delete
	from BMS_NODE_MST
	where NODE_ID = #{NODE_ID}
</delete>


<select id="SI0503P0R0" resultType="Map">
	
	
</select>


</mapper>
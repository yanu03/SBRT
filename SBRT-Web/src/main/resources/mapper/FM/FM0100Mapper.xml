<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.tracom.bms.domain.FM0100.FM0100Mapper">

<select id="FM0100G0R0" resultType="Map">
	SELECT 
		SM.STTN_ID
		,SM.STTN_NO
		,SM.STTN_NM
		,NM.GPS_Y
		,NM.GPS_X
		,SM.REMARK
		,SM.NODE_ID
	FROM
		sbrt.BMS_STTN_MST SM 
	JOIN 
		sbrt.BMS_NODE_MST NM 
	ON 
		SM.NODE_ID = NM.NODE_ID
	
	<where>	
		<if test="TYPE == 'ALL' and CONTENT != null and CONTENT != ''">
			VHC_ID LIKE CONCAT('%',#{CONTENT},'%') || VHC_NO LIKE CONCAT('%',#{CONTENT},'%') 
		</if>
		<if test="TYPE == 'STTN_ID'">
			STTN_ID LIKE CONCAT('%',#{CONTENT},'%')
		</if>
		<if test="TYPE == 'STTN_NO'">
			STTN_NO LIKE CONCAT('%',#{CONTENT},'%') 
		</if>
	</where>
</select>

<select id="FM0100SHI0" resultType="Map">
	SELECT			STTN_ID
					,STTN_NO	
	FROM			BMS_STTN_MST
</select>

<select id="FM0100G1R0" resultType="Map">
	SELECT 
		FCLT_ID
		,MAKER
		,FCLT_KIND
		,MRO_ID
		,INST_LOC
		,MODEL_NM
		,DATE_FORMAT(BUY_DT, '%Y%m%d') BUY_DT
		,DATE_FORMAT(INST_DT, '%Y%m%d') INST_DT
		,USE_YN
		,REMARK
		,NODE_ID
	FROM
		BMS_FCLT_INFO
	WHERE
		NODE_ID = #{NODE_ID}
	
</select>

<select id="FM0100SHI1" resultType="Map">
	SELECT			ORG_ID
					,ORG_NM
	FROM	  		BMS_ORG_MST
	WHERE			ORG_DIV = 'OGD08'
</select>

<select id="FM0100SHI2" resultType="Map">
	SELECT			CLSFCTN_ID
					,CLSFCTN_NM
	FROM	  		BMS_EMER_CLSFCTN_MST
</select>	

<select id="FM0100G1K0" resultType="Map">
	SELECT CONCAT('FC', LPAD(NEXTVAL(sbrt.SEQ_BMS_FCLT_INFO_0), 8, '0')) AS 'SEQ'
</select>	

<insert id="FM0100G1I0" parameterType="Map">
	INSERT INTO		BMS_FCLT_INFO	
					(
						FCLT_ID
						,NODE_ID
						,MAKER
						,MRO_ID
						,FCLT_KIND
						,FCLT_TYPE
						,INST_LOC
						,MNG_ID
						,GPS_X
						,GPS_Y
						,TM_X
						,TM_Y
						,FCLT_IP
						,REL_KIND
						,REL_ID
						,DEV_SERIAL_NO
						,MODEL_NM
						,INST_DT
						,BUY_DT
						,CCTV_URL
						,USE_YN
						,REMARK
						,UPD_DTM
						,UPD_ID
					)
	VALUES			(
						#{FCLT_ID}
						,#{NODE_ID}
						,#{MAKER}
						,#{MRO_ID}
						,#{FCLT_KIND}
						,#{FCLT_TYPE}
						,#{INST_LOC}
						,#{MNG_ID}
						,#{GPS_X}
						,#{GPS_Y}
						,#{TM_X}
						,#{TM_Y}
						,#{FCLT_IP}
						,#{REL_KIND}
						,#{REL_ID}
						,#{DEV_SERIAL_NO}
						,#{MODEL_NM}
						,STR_TO_DATE(#{INST_DT}, '%Y%m%d')
						,STR_TO_DATE(#{BUY_DT}, '%Y%m%d')
						,#{CCTV_URL}
						,#{USE_YN}
						,#{REMARK}
						,#{UPD_DTM}
						,#{UPD_ID}	
					)
</insert>

<update id="FM0100G1U0" parameterType="Map">
	UPDATE			BMS_FCLT_INFO
	SET				FCLT_ID = #{FCLT_ID}
					,MAKER = #{MAKER}
					,FCLT_KIND = #{FCLT_KIND}
					,INST_LOC = #{INST_LOC}
					,MODEL_NM = #{MODEL_NM}
					,MRO_ID = #{MRO_ID}	
					,USE_YN = #{USE_YN}	
					,REMARK = #{REMARK}
					,INST_DT = STR_TO_DATE(#{INST_DT}, '%Y%m%d')
					,BUY_DT = STR_TO_DATE(#{BUY_DT}, '%Y%m%d')
					
	WHERE			FCLT_ID = #{FCLT_ID}							 	
</update>

<delete id="FM0100G1D0" parameterType="Map">
	DELETE FROM 	BMS_FCLT_INFO
	WHERE			FCLT_ID = #{FCLT_ID}
</delete>
</mapper>
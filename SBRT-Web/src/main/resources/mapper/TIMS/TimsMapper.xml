<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="kr.tracom.tims.domain.TimsMapper">
	
	<insert id="insertEventHistory" parameterType="Map">
		INSERT INTO BRT_OPER_EVENT_HIS (
			OPER_DT
			,REP_ROUT_ID
			,VHC_ID
			,UPD_DTM
			,VHC_NO
			,DRV_ID
			,COR_ID
			,ROUT_ID
			,GPS_X_RAW
			,GPS_Y_RAW
			,DRV_ANGLE
			,GPS_X
			,GPS_Y
			,CUR_SPD
			,LINK_ID
			,NODE_ID
			,NODE_SN
			,OPER_STS
			,EVT_TYPE
			,EVT_DATA
			,STOP_TM
			,OCR_DTM
		) 
		VALUES (
			DATE_FORMAT(#{UPD_DTM}, '%Y-%m-%d')
			,(SELECT REP_ROUT_ID FROM BMS_ROUT_MST WHERE ROUT_ID = #{ROUT_ID})			
			,(SELECT VHC_ID FROM BMS_VHC_MST WHERE VHC_NO = #{BUS_NO})
			,NOW()
			,#{BUS_NO}
			,#{DRV_ID}
			,#{COURSE_ID}
			,#{ROUT_ID}
			,#{LONGITUDE_RAW}
			,#{LATITUDE_RAW}
			,#{HEADING}
			,#{LONGITUDE}
			,#{LATITUDE}
			,#{SPEED}
			,#{LINK_ID}
			,#{NODE_ID}
			,#{NODE_SN}
			,(SELECT DL_CD FROM BMS_DL_CD_INFO WHERE CO_CD = 'VHC_OPER_TYPE' AND NUM_VAL4 = #{RUN_TYPE}) <!-- 운행 유형  -->
			,(SELECT DL_CD FROM BMS_DL_CD_INFO WHERE CO_CD = 'OPER_EVT_TYPE' AND NUM_VAL4 = #{EVENT_CD}) <!-- 운행이벤트 유형  -->
			,#{EVENT_DATA} 
			,#{STOP_TM}
			,#{UPD_DTM}
		)
	</insert>
	<!-- 차량정보 가져오기  -->
	<select id="selectVhcInfo" resultType="Map" parameterType="Map">
		SELECT  
			VHC_ID
			,DVC_ID
		FROM 	
			BMS_DVC_INFO
		WHERE MNG_ID = #{MNG_ID}
	</select>
	
	<!-- 노선이름 가져오기  -->
	<select id="selectRoutName" resultType="String" parameterType="String">
		SELECT  
			ROUT_NM
		FROM 	
			BMS_ROUT_MST
		WHERE ROUT_ID = #{ROUT_ID}
	</select>
	


	
</mapper>
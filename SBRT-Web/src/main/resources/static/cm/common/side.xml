<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cm/css/all.css" type="text/css"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate />
		<xf:model>
			<xf:instance>
				<data xmlns="" />
			</xf:instance>
			<w2:dataCollection baseNode="map">
				<w2:dataList id="dlt_menu" baseNode="list" saveRemovedData="true" repeatNode="map"
					ev:ondataload="scwin.dlt_menu_ondataload">
					<w2:columnInfo>
						<w2:column id="MENU_CD" name="메뉴코드" dataType="text"></w2:column>
						<w2:column id="MENU_NM" name="메뉴명" dataType="text"></w2:column>
						<w2:column id="USE_YN" name="사용유무" dataType="text"></w2:column>
						<w2:column id="PROG_PH" name="메뉴경로" dataType="text"></w2:column>
						<w2:column id="PARENT_MENU_CD" name="부모메뉴코드" dataType="text"></w2:column>
						<w2:column id="LEVEL" name="메뉴레벨" dataType="text"></w2:column>
						<w2:column id="SORT" name="정렬순서" dataType="text"></w2:column>
						<w2:column id="PROG_CD" name="프로그램코드" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
				<w2:dataMap baseNode="map" id="dma_result">
					<w2:keyInfo>
						<w2:key id="STATUS" name="name1" dataType="text"></w2:key>
						<w2:key id="ICNT" name="name2" dataType="text"></w2:key>
						<w2:key id="UCNT" name="name3" dataType="text"></w2:key>
						<w2:key id="DCNT" name="name4" dataType="text"></w2:key>
						<w2:key id="TYPE" name="name5" dataType="text"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataMap baseNode="map" id="dma_defInfo">
					<w2:keyInfo>
						<w2:key id="USER_ID" name="사용자아이디" dataType="text"></w2:key>
						<w2:key id="USER_NM" name="사용자명" dataType="text"></w2:key>
						<w2:key id="CUR_SYSTEM" name="현재시스템" dataType="text"></w2:key>
						<w2:key id="IS_ADMIN" name="관리자여부" dataType="text"></w2:key>
						<w2:key id="USE_YN_SHORTCUT" name="단축키사용여부" dataType="text"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataList baseNode="list" repeatNode="map" id="dlt_programAuthority" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="PROG_CD" name="프로그램코드" dataType="text"></w2:column>
						<w2:column id="AUTH_CHECK" name="조회권한여부" dataType="text"></w2:column>
						<w2:column id="SAV_AH" name="저장권한여부" dataType="text"></w2:column>
						<w2:column id="EXL_AH" name="엑셀권한여부" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
			</w2:dataCollection>
			
		</xf:model>
		<style type="text/css"><![CDATA[
			
		]]></style>
		<script type="text/javascript" lazy="false"><![CDATA[
	
	scwin.onpageload = function() {
		
	};
	
	scwin.onpageunload = function() {
	
	};
	
	scwin.fn_getInitData = function() {
		var searchCodeGrpOption = { id : "sbm_InitCont", action : "/main/init", 
									target : 'data:json, ["dlt_menu", "dma_defInfo", "dlt_programAuthority"]', method : "post",
									mediatype : "application/json", mode : "asynchronous", isShowMeg : false,
									submitDoneHandler : scwin.initDataCallback };
		com.executeSubmission_dynamic(searchCodeGrpOption);
	};

	scwin.initDataCallback = function() {

		var curSystem = dma_defInfo.get("CUR_SYSTEM");

		$p.parent().wfm_header.getWindow().txt_userNm.setValue(dma_defInfo.get("USER_NM"));

		//scwin.openMenu("메인","/cm/common/main.xml","MAIN");
		if(curSystem==1){
			$p.parent().wfm_header.getWindow().txt_systemNm.setValue("통합운영관리");
		}
		else if(curSystem==2){
			$p.parent().wfm_header.getWindow().txt_systemNm.setValue("차량운행관리");
		}
	
		var index = 0;
		var tmpMenus = dlt_menu.getAllJSON();
		
		for (index in tmpMenus) {
			if( tmpMenus[index].PROG_PH != '' && tmpMenus[index].PROG_PH != null ){
				break;
			}
		}
		scwin.openMenu(tmpMenus[index].MENU_NM,tmpMenus[index].PROG_PH,tmpMenus[index].MENU_CD);
		
	};
	
	scwin.dlt_menu_ondataload = function() {
		$p.top().scwin.setHeaderMenu();
	};


	/**
	 * 파라메터를 참조하여 화면을 연다. 
	 * 메뉴를 최근 작업 항목에 추가하거나 메뉴 트리를 선택하게 하려면 scwin.setMenuRelation를 사용한다.
	 * @lastUpdate 2018.04.10
	 * @param <String> menuNm 메뉴명 - 단위화면에서 해당 값으로 title을 설정한다.
	 * @param <String> url 화면 파일 경로
	 * @param <String> menuCode 메뉴코드 - DB에 저장되어있는 메뉴 코드
	 * @author InswaveSystems
	 * @since 2016.08.28
	 * @example
	 * scwin.openMenu("인사조회","/tmp/tmp01.xml","010001");
	 */
	scwin.openMenu = function(menuNm, url, menuCode, paramObj, menuType) {

		// client에서 url 숨기기 메뉴일 경우에는 새 창으로 띄우기 적용 
		if (url == "/") {
			var url = document.location.href + "/";
			window.open(url, "", "width=1200, height=700, left=450, top=100");
		} else {
			menuCode = menuCode || "";
			var layout = $p.top().scwin.getLayoutId();
			var tmpUrl;
			var menuCodeParm = menuCode;
			var frameMode;	// "wframe", "iframe"
			var favStatus;
			var data;

			if (url.indexOf("/") !== 0) {
				url = "/" + url;
			}
			url = gcm.CONTEXT_PATH + url;
			
			if ((typeof paramObj !== "undefined") && (paramObj !== null)) {
				data = paramObj;
			} else {
				data = {};
			}
			
			data.menuNm = menuNm;
			data.menuCode = menuCode;
			data.favStatus = favStatus;
			data.menuType = menuType;
			
			var _closable = true;
			if(url == "/cm/common/main.xml"){
				_closable = false;
			}
			
			var frameMode = "";
			if (layout == "T") {
				var tabObj = { closable : _closable, //main 페이지를 제외하고 탭 닫기 기능 제공
							   openAction : "select", // exist 는 기존 탭을 갱신, new 는 항상 새로, select는 동일 id 가 존재하면 선택, last: 기존 tab을 마지막 tab으로 이동후 선택
							   label : menuNm };
				
				if (com.getFrameMode()  === "wframe") {
					frameMode = "wframePreload";
				} else {
					frameMode = "iframe";
				}
				
				var contObj = {
					frameMode : frameMode,
					scope : true,
					src : url,
					alwaysDraw : false,
					title : menuNm,
					dataObject : {
						type : "json", 
						name : "param", 
						data : data
					}
				};
				var tabComp = $w.getComponentById("mf_tac_layout");
				tabComp.addTab(menuCode, tabObj, contObj);

				// tabObj의 openAction의 last값의 동작 특이 사항으로 선택이 되지 않은 경우 선택하는 로직 추가
				if (tabComp.getSelectedTabID() !== menuCode) {
					var tabIndex = tabComp.getTabIndex(menuCode);
					if (tabIndex) {
						tabComp.setSelectedTabIndex(tabIndex);
					}
				}
			} else if (layout == "M") {
				if (com.getFrameMode() === "wframe") {
					frameMode = "wframe";
				} else {
					frameMode = "iframe";
				}
				
				var options = {
					title : menuNm,
					src : url,
					windowTitle : menuNm,
					windowId : menuCode,
					openAction : "existWindow",
					frameMode : frameMode,
					dataObject : { 
						type : "json", 
						name : "param", 
						data : data
					}
				}
				var wdcComp = $w.getComponentById("mf_wdc_main");
				wdcComp.createWindow(options);
			}
		}
	};
	]]></script>
	</head>
	<body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">

	</body>
</html>
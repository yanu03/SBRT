<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cm/css/all.css" type="text/css"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<!-- 
		#####################################################################
		파일명 : SM0500M01.xml
		프로그램명 : 조직 관리 
		설 명 : 조직을 관리(등록,수정,삭제)하는 화면
		작성자 : Inswave Systems
		작성일 : 2016.10.24
		
		수정일자	  수정자			 수정내용
		=====================================================================
		2016.10.24	Inswave Systems	최초작성
		2018.01.26	Inswave Systems	WebSquare5 SP2 기능을 적용하도록 소스 업그레이드
		2018.11.12	Inswave Systems	WebSquare5 SP3 기능을 적용하도록 소스 업그레이드
		#####################################################################
		-->
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate />
		<xf:model>
			<xf:instance>
				<data xmlns="" />
			</xf:instance>
			<w2:dataCollection baseNode="map">
				<w2:dataList id="dlt_organizationBasic" baseNode="list" saveRemovedData="true" repeatNode="map" ev:oncelldatachange="" undoRecursiveRow="true">
					<w2:columnInfo>
						<w2:column id="chk" name="선택" dataType="text" ignoreStatus="true"></w2:column>
						<w2:column id="ORG_ID" name="기관아이디" dataType="text"></w2:column>
						<w2:column id="SORT" name="정렬순서" dataType="text"></w2:column>
						<w2:column id="ORG_DIV" name="기관구분" dataType="text"></w2:column>
						<w2:column id="ORG_NM" name="기관명" dataType="text"></w2:column>
						<w2:column id="ORG_ENM" name="기관영문명" dataType="text"></w2:column>
						<w2:column id="REP_NM" name="대표자명" dataType="text"></w2:column>
						<w2:column id="COMP_REG_NO" name="사업자등록번호" dataType="text"></w2:column>
						<w2:column id="ADDR" name="주소" dataType="text"></w2:column>
						<w2:column id="PHONE" name="전화번호" dataType="text"></w2:column>
						<w2:column id="FAX" name="팩스" dataType="text"></w2:column>
						<w2:column id="EMAIL" name="이메일" dataType="text"></w2:column>
						<w2:column id="REMARK" name="비고" dataType="text"></w2:column>
					</w2:columnInfo>
					<w2:data></w2:data>
				</w2:dataList>
				<w2:dataMap baseNode="map" id="dma_search">
					<w2:keyInfo>
						<w2:key id="TYPE" name="name1" dataType="text"></w2:key>
						<w2:key id="CONTENT" name="name2" dataType="text"></w2:key>
						<w2:key id="USE_YN" name="name3" dataType="text"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataMap baseNode="map" id="dma_result">
					<w2:keyInfo>
						<w2:key id="STATUS" name="name1" dataType="text"></w2:key>
						<w2:key id="ICNT" name="name2" dataType="text"></w2:key>
						<w2:key id="UCNT" name="name3" dataType="text"></w2:key>
						<w2:key id="DCNT" name="name4" dataType="text"></w2:key>
						<w2:key id="TYPE" name="name5" dataType="text"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataList id="dlt_organizationSearchItem" baseNode="list" saveRemovedData="true" repeatNode="map">
					<w2:columnInfo>
						<w2:column id="ORG_ID" name="name1" dataType="text"></w2:column>
						<w2:column id="ORG_NM" name="name2" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
			</w2:dataCollection>
			<w2:workflowCollection></w2:workflowCollection>
			<xf:submission id="sbm_searchOrganization" ref="data:json,dma_search" target='data:json,dlt_organizationBasic'
				action="/organization/searchOrganization" method="post" mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler=""
				customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sbm_searchOrganization_submitdone" ev:submiterror="" abortTrigger="">
			</xf:submission>
			<xf:submission id="sbm_saveOrganizationBasic" ref='data:json,{"id":"dlt_organizationBasic","action":"modified"}'
				target="data:json,dlt_organizationBasic" action="/organization/updateOrganizationBasic" method="post" mediatype="application/json" encoding="UTF-8"
				instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" processMsg="저장중 입니다..." ev:submit=""
				ev:submitdone="scwin.sbm_saveOrganizationBasic_submitdone" ev:submiterror="">
			</xf:submission>
			<xf:submission id="sbm_organizationSearchItem" ref="" target='data:json,["dlt_organizationSearchItem","dlt_organizationBoss"]' action="/organization/selectOrganizaionSearchItem"
				method="post" mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" processMsg=""
				ev:submit="" ev:submitdone="" ev:submiterror="" abortTrigger="">
			</xf:submission>
		</xf:model>
		<script type="text/javascript" lazy="false"><![CDATA[
	/**
	 * 초기 스크립트 수행 함수 정의
	 */
	scwin.onpageload = function() {
		var codeOptions = [ { "code" : "ORG_DIV", "compID" : "sbx_OrgDiv, grd_organizationBasic:ORG_DIV" } ];
		com.setCommonDtl(codeOptions);
		com.executeSubmission(sbm_organizationSearchItem);
		com.setEnterKeyEvent(tbl_search, scwin.btn_Search_onclick);
		com.setGridViewDelCheckBox([grd_organizationBasic]);
	};
	
	scwin.onpageunload = function() {

	};
	

	/**
	 * 검색항목(selectBox)의 내용이 변경되었을 때 실행된다
	 */
	scwin.sbx_ChoiceBox_onviewchange = function(info) {
		if (info.newValue == "ORG_ID") {
			acb_autoChoiceBox.setNodeSet("data:dlt_organizationSearchItem", "ORG_ID", "ORG_ID");;
			acb_autoChoiceBox.show("");
		} else if (info.newValue == "ORG_NM") {
			acb_autoChoiceBox.setNodeSet("data:dlt_organizationSearchItem", "ORG_NM", "ORG_NM");
			acb_autoChoiceBox.show("");
		}
	};
	
	/**
	 * 조직기본관리 조회버튼 클릭시 발생하며, 조건에 따른 조직기본관리 리스트를 조회한다.
	 */
	scwin.btn_Search_onclick = function() {
		dma_search.set("CONTENT", acb_autoChoiceBox.getValue());
		com.executeSubmission(sbm_searchOrganization);
	};
	
	/**
	 * 조직기본관리 버튼 클릭의 콜백메소드 건수 조회, ReadOnly 그리드뷰 컬럼색 변경, 조직 레벨에 따른 기관명, 상위소속명의 폰트색을 변경한다.
	 */
	scwin.sbm_searchOrganization_submitdone = function(e) {
		spn_organizationCnt.setValue(dlt_organizationBasic.getRowCount());
	};
	
	/**
	 * 조직기본관리 등록 버튼 클릭
	 */
	scwin.btn_addOrganization_onclick = function() {
	
		var org_cnt = dlt_organizationBasic.getTotalRow();
		if (org_cnt == 0) {
			com.alert("조회 후 이용하세요.");
			return;
		}
	
		if (grd_organizationBasic.getFocusedRealRowIndex() === -1) {
			grd_organizationBasic.setFocusedCell(0, "ORG_ID");
		}
		
		scwin.insertRowOrg();
	};
	
	/**
	 * 같은 레벨의 노트에 조직을 추가한다.
	 */
	scwin.insertRowOrg = function() {
		var focusedRowIndex = grd_organizationBasic.getFocusedRealRowIndex();
		var curOrgId = dlt_organizationBasic.getCellData(focusedRowIndex, "ORG_ID");
		var rowIndexArr = dlt_organizationBasic.getMatchedIndex("ORG_ID", curOrgId, true, 0, dlt_organizationBasic.getRowCount());
		var sortOrder = WebSquare.util.getNumber(dlt_organizationBasic.getCellData(rowIndexArr[rowIndexArr.length - 1], "SORT")) + 1;
		var insertRowIndex = scwin.getInsertRowIndex(curOrgId);
		var insertJson = [ {"SORT" : sortOrder } ];
	
		dlt_organizationBasic.insertJSON(insertRowIndex, insertJson);
		grd_organizationBasic.setFocusedCell(insertRowIndex, "ORG_ID");
		ibx_orgNm.focus();
	};
	
	/**
	 * 새로 추가되는 조직으로 RowIndex를 반환한다.
	 */
	scwin.getInsertRowIndex = function(curOrgId) {
		var rowIndexArr = dlt_organizationBasic.getMatchedIndex("ORG_ID", curOrgId, true, 0, dlt_organizationBasic.getRowCount());
		if (rowIndexArr.length > 0) {
			return rowIndexArr[rowIndexArr.length - 1] + 1;
		} else {
			return -1;
		}
	};
	
	/**
	 * 조직기본관리 삭제 버튼 클릭
	 */
	scwin.btn_delOrganization_onclick = function() {
		dlt_organizationBasic.deleteRows(grd_organizationBasic.getCheckedIndex("chk"));
	};
	
	/**
	 * 조직기본관리 취소 버튼 클릭
	 */
	scwin.btn_cancelOrganization_onclick = function() {
		dlt_organizationBasic.undoAll();
		dlt_organizationBasic.removeRows(dlt_organizationBasic.getInsertedIndex());
	};
	
	/**
	 * 조직기본관리 저장 버튼 클릭
	 */
	scwin.btn_saveOrganization_onclick = function() {
		var modifiedCount = dlt_organizationBasic.getModifiedIndex().length;
		
		if (modifiedCount > 0) {
			if (com.validateGroup(grp_organizationBasic)) {
				com.confirm(modifiedCount + "건의 데이타를 반영하시겠습니까", function(rtn) {
					if (rtn) { 
						com.executeSubmission(sbm_saveOrganizationBasic);
					}
				});
			}
		} else {
			com.alert("저장할 데이터가 없습니다.");
		}
	};
	
	/**
	 * 조직기본관리 저장 버튼의 콜백메소드
	 */
	scwin.sbm_saveOrganizationBasic_submitdone = function(e) {
		com.executeSubmission(sbm_searchOrganization);
	};
	
	scwin.btn_excelOrganization_onclick = function() {
		com.downLoadExcel(grd_organizationBasic);
	};
	]]></script>
	</head>
	<body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">
		<xf:group class="contentWrap" id="" style="">
			<w2:wframe id="" style="" src="/cm/common/wf_titleFav.xml" scope="true"></w2:wframe>
			<xf:group id="" style="" class="section">
				<xf:group id="tbl_search" style="" class="tbl_search">
					<xf:group id="" style="width:100%;" adaptive="layout" class="w2tb tbl_sc" adaptiveThreshold="768" tagname="table">
						<w2:attributes>
							<w2:summary></w2:summary>
						</w2:attributes>
						<xf:group tagname="colgroup">
							<xf:group style="width:80px;" tagname="col"></xf:group>
							<xf:group style="" tagname="col"></xf:group>
							<xf:group style="width:200px;" tagname="col"></xf:group>
						</xf:group>
						<xf:group tagname="tr">
							<xf:group style="" class="w2tb_th" tagname="th">검색항목</xf:group>
							<xf:group style="" class="w2tb_td" tagname="td">
								<xf:select1 disabledClass="w2selectbox_disabled" appearance="minimal" direction="auto" chooseOption=""
									displayMode="label" optionOrder="false" ev:onviewchange="scwin.sbx_ChoiceBox_onviewchange" id="sbx_ChoiceBox"
									ref="data:dma_search.TYPE" style="height:20px;width:80px;margin-right: 10px;float:left;" allOption="" submenuSize="auto"
									disabled="false" textAlign="left">
									<xf:choices>
										<xf:item>
											<xf:label><![CDATA[기관명]]></xf:label>
											<xf:value><![CDATA[ORG_NM]]></xf:value>
										</xf:item>
										<xf:item>
											<xf:label><![CDATA[기관아이디]]></xf:label>
											<xf:value><![CDATA[ORG_ID]]></xf:value>
										</xf:item>
									</xf:choices>
								</xf:select1>
								<w2:autoComplete interactionMode="" chooseOptionValue="" chooseOptionLabel="-전체-" visibleRowNum="" chooseOption="true"
									caseSensitive="false" displayMode="label" ev:onviewchange="" id="acb_autoChoiceBox" useKeywordHighlight="false" ref=""
									style="height: 21px;float: left;" search="start" ev:onchange="" allOption="" submenuSize="auto" editType="select" textAlign="left" noResult="useData" class="calc120">
									<w2:choices>
										<w2:itemset nodeset="data:dlt_organizationSearchItem">
											<w2:label ref="ORG_NM"></w2:label>
											<w2:value ref="ORG_NM"></w2:value>
										</w2:itemset>
									</w2:choices>
								</w2:autoComplete>
							</xf:group>
							<xf:group style="" class="w2tb_td" tagname="td">
								<w2:anchor id="" style="" ev:onclick="scwin.btn_Search_onclick" class="btn_sh" outerDiv="true">
									<xf:label><![CDATA[조회]]></xf:label>
								</w2:anchor>
							</xf:group>
						</xf:group>
					</xf:group>
				</xf:group>
			</xf:group>
			<xf:group id="" style="" class="section">
				<xf:group id="" style="" class="defaultbox">
					<w2:textbox id="" style="" class="df_tt fl" label="기관"></w2:textbox>
					<xf:group id="" style="height:22px;" class="fr">
						<w2:span id="spn_organizationCnt" style="" class="df_total" label="" displayFormat="건"></w2:span>
						<xf:group id="" style="" class="ml5 fr">
							<w2:anchor id="btn_addOrganization" style="" clickEventElement="outerDiv"
								ev:onclick="scwin.btn_addOrganization_onclick" class="btn_gcm" outerDiv="true">
								<xf:label><![CDATA[등록]]></xf:label>
							</w2:anchor>
							<w2:anchor id="btn_delOrganization" style="" clickEventElement="outerDiv"
								ev:onclick="scwin.btn_delOrganization_onclick" class="btn_gcm" outerDiv="true">
								<xf:label><![CDATA[삭제]]></xf:label>
							</w2:anchor>
							<w2:anchor id="btn_cancelOrganization" style="" clickEventElement="outerDiv"
								ev:onclick="scwin.btn_cancelOrganization_onclick" class="btn_gcm" outerDiv="true">
								<xf:label><![CDATA[취소]]></xf:label>
							</w2:anchor>
							<w2:anchor id="btn_saveOrganization" style="" clickEventElement="outerDiv"
								ev:onclick="scwin.btn_saveOrganization_onclick" class="btn_gcm" outerDiv="true">
								<xf:label><![CDATA[저장]]></xf:label>
							</w2:anchor>
							<w2:anchor class="btn_gcm" clickEventElement="outerDiv" ev:onclick="scwin.btn_excelOrganization_onclick"
								id="btn_excelOrganization" outerDiv="true" style="">
								<xf:label><![CDATA[엑셀]]></xf:label>
							</w2:anchor>
						</xf:group>
					</xf:group>
				</xf:group>
				<w2:gridView ignoreCellClick="false" ev:onrowindexchange="" autoFit="allColumn" visibleRowNum="10" sortable="true"
					sortEvent="onclick" class="cm_grid" showSortableImage="" fixedColumnWithHidden="true" dataList="dlt_organizationBasic"
					id="grd_organizationBasic" readOnly="true" style="height: 280px;" overflowX="hidden" scrollByColumn="false" useShiftKey="true"
					overflowY="scroll" rowStatusVisible="false" rowStatusHeaderValue="상태" ev:oncellclick="" adaptive="crosstab" rowNumVisible="true" rowNumHeaderValue="순서">
					<w2:header id="header1" style="">
						<w2:row id="row2" style="">
							<w2:column id="chk" blockSelect="false" style="height:25px;" width="40" inputType="checkbox" displayMode="label"
								fixColumnWidth="true">
							</w2:column>
							<w2:column id="column9" blockSelect="false" style="height:25px;" width="87" inputType="text" value="기관아이디"
								displayMode="label">
							</w2:column>
							<w2:column id="column17" blockSelect="false" style="height:25px;" width="206" inputType="text" value="기관명"
								displayMode="label">
							</w2:column>
							<w2:column id="column11" blockSelect="false" style="height:25px;" width="80" inputType="text" value="기관구분"
								displayMode="label">
							</w2:column>
							<w2:column id="column30" blockSelect="false" style="height:25px;" width="126" inputType="text"
								value="사업자등록번호">
							</w2:column>
							<w2:column removeBorderStyle="false" width="70" inputType="text" style="height:25px" id="column31" value="전화번호"
								blockSelect="false" displayMode="label">
							</w2:column>
							<w2:column id="column28" blockSelect="false" style="height:25px;" width="70" inputType="text" value="팩스"></w2:column>
							<w2:column id="column18" blockSelect="false" style="height:25px;" width="70" inputType="text" value="이메일"></w2:column>
						</w2:row>
					</w2:header>
					<w2:gBody id="gBody4" style="" width="40">
						<w2:row id="row5" style="">
							<w2:column id="chk" blockSelect="false" readOnly="false" style="height:25px;" width="40" inputType="checkbox"
								displayMode="label" fixColumnWidth="true">
							</w2:column>
							<w2:column id="ORG_ID" blockSelect="false" style="height:25px;" width="87" inputType="text"
								displayMode="label">
							</w2:column>
							<w2:column id="ORG_NM" blockSelect="false" style="height:25px;" width="136" inputType="text"
								displayMode="label">
							</w2:column>
							<w2:column id="ORG_DIV" blockSelect="false" style="height:25px;" width="80" inputType="select"
								displayMode="label" textAlign="center">
								<w2:choices>
									<w2:itemset nodeset="">
										<w2:label ref=""></w2:label>
										<w2:value ref=""></w2:value>
									</w2:itemset>
								</w2:choices>
							</w2:column>
							<w2:column id="COMP_REG_NO" blockSelect="false" style="height:25px;" width="126" inputType="text">
								<w2:choices>
									<w2:itemset nodeset="data:dlt_organizationBasic">
										<w2:label ref="PARENT_ORG_NM"></w2:label>
										<w2:value ref="PARENT_ORG_NM"></w2:value>
									</w2:itemset>
								</w2:choices>
							</w2:column>
							<w2:column removeBorderStyle="false" width="70" inputType="text" style="height:25px" id="PHONE" value=""
								blockSelect="false" displayMode="label">
							</w2:column>
							<w2:column removeBorderStyle="false" width="70" inputType="text" style="height:25px" id="FAX" value=""
								blockSelect="false" displayMode="label">
							</w2:column>
							<w2:column removeBorderStyle="false" width="70" inputType="text" style="height:25px" id="EMAIL" value=""
								blockSelect="false" displayMode="label">
							</w2:column>
						</w2:row>
					</w2:gBody>
				</w2:gridView>
			</xf:group>
			<xf:group id="grp_organizationBasic" style="" class="section">
				<xf:group id="" style="width:100%;" class="w2tb tb" tagname="table" adaptive="layout">
					<w2:attributes>
						<w2:summary></w2:summary>
					</w2:attributes>
					<xf:group tagname="colgroup">
						<xf:group style="width:150px;" tagname="col"></xf:group>
						<xf:group style="" tagname="col"></xf:group>
						<xf:group style="width:150px;" tagname="col"></xf:group>
						<xf:group style="" tagname="col"></xf:group>
					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group style="" class="w2tb_th" tagname="th">기관아이디</xf:group>
						<xf:group style="" class="w2tb_td" tagname="td">
							<xf:input id="ibx_orgId" ref="data:dlt_organizationBasic.ORG_ID" style="height:24px;" disabled="true"></xf:input>
						</xf:group>
						<xf:group class="w2tb_th req" tagname="th">기관명</xf:group>
						<xf:group class="w2tb_td" tagname="td">
							<xf:input id="ibx_orgNm" ref="data:dlt_organizationBasic.ORG_NM" style="height:24px;" class="req" mandatory="true"></xf:input>
						</xf:group>
					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group style="" class="w2tb_th req" tagname="th">기관구분</xf:group>
						<xf:group style="" class="w2tb_td" tagname="td">
							<xf:select1 disabledClass="w2selectbox_disabled" appearance="minimal" chooseOptionLabel="전체" direction="auto"
								chooseOption="false" mandatory="true" displayMode="label" optionOrder="" id="sbx_OrgDiv" ref="data:dlt_organizationBasic.ORG_DIV"
								style="height:24px;" allOption="" submenuSize="auto" disabled="false" class="req" renderType="component">
								<xf:choices></xf:choices>
							</xf:select1>
						</xf:group>
						<xf:group class="w2tb_th" tagname="th">기관영문명</xf:group>
						<xf:group class="w2tb_td" tagname="td">
							<xf:input id="ibx_orgEnm" ref="data:dlt_organizationBasic.ORG_ENM" style="height:24px;" refSync=""></xf:input>
						</xf:group>
					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group style="" class="w2tb_th" tagname="th">대표자명</xf:group>
						<xf:group style="" class="w2tb_td" tagname="td">
							<xf:input id="ibx_repNm" ref="data:dlt_organizationBasic.REP_NM" style="height:24px;"></xf:input>
						</xf:group>
						<xf:group class="w2tb_th" tagname="th">사업자등록번호</xf:group>
						<xf:group class="w2tb_td" tagname="td">
							<xf:input id="ibx_compRegNo" ref="data:dlt_organizationBasic.COMP_REG_NO" style="height:24px;" readOnly="" readOnlyClass="" initValue=""></xf:input>
						</xf:group>
					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group style="" class="w2tb_th" tagname="th">주소</xf:group>
						<xf:group style="" class="w2tb_td" tagname="td">
							<xf:input id="ibx_orgAddr" ref="data:dlt_organizationBasic.ADDR" style="height:24px;" disabled="" refSync=""></xf:input>
						</xf:group>
						<xf:group class="w2tb_th" tagname="th">전화번호</xf:group>
						<xf:group class="w2tb_td" tagname="td">
							<xf:input id="ibx_orgPhone" ref="data:dlt_organizationBasic.PHONE" style="height:24px;" disabled="" refSync=""></xf:input>
						</xf:group>
					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group style="" class="w2tb_th" tagname="th">팩스</xf:group>
						<xf:group style="" class="w2tb_td" tagname="td">
							<xf:input disabled="" id="ibx_orgFax" ref="data:dlt_organizationBasic.FAX" refSync="" style="height:24px;" initValue=""></xf:input>
						</xf:group>
						<xf:group class="w2tb_th" tagname="th">이메일</xf:group>
						<xf:group class="w2tb_td" tagname="td">
							<xf:input disabled="" id="ibx_orgEMail" initValue="" ref="data:dlt_organizationBasic.EMAIL" refSync=""
								style="height:24px;" readOnlyClass="">
							</xf:input>
						</xf:group>
					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group style="" class="w2tb_th" tagname="th">비고</xf:group>
						<xf:group style="" class="w2tb_td" tagname="td">
							<w2:attributes>
								<w2:colspan>3</w2:colspan>
								<w2:rowspan>1</w2:rowspan>
							</w2:attributes>
							<xf:input id="ibx_remark" ref="data:dlt_organizationBasic.REMARK" style="height:24px;"></xf:input>
						</xf:group>
					</xf:group>
				</xf:group>
			</xf:group>
		</xf:group>
	</body>
</html>
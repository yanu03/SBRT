<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ev="http://www.w3.org/2001/xml-events"
	xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate />
		<xf:model>
			<xf:instance>
				<data xmlns="" />
			</xf:instance>
			<w2:dataCollection baseNode="map">
				<w2:dataMap baseNode="map" id="dma_search">
					<w2:keyInfo>
						<w2:key id="TYPE" name="name4" dataType="text"></w2:key>
						<w2:key id="CONTENT1" name="name1" dataType="text"></w2:key>
						<w2:key id="CONTENT2" name="name2" dataType="text"></w2:key>
						<w2:key id="CONTENT3" name="name3" dataType="text"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataMap baseNode="map" id="dma_result">
					<w2:keyInfo>
						<w2:key id="STATUS" name="STATUS" dataType="text"></w2:key>
						<w2:key id="ICNT" name="입력건수" dataType="text"></w2:key>
						<w2:key id="UCNT" name="수정건수" dataType="text"></w2:key>
						<w2:key id="DCNT" name="삭제건수" dataType="text"></w2:key>
						<w2:key id="TYPE" name="TYPE" dataType="text"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataList baseNode="list" repeatNode="map" id="dlt_repRoutItem" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="REP_ROUT_ID" name="대표노선ID" dataType="text"></w2:column>
						<w2:column id="REP_ROUT_NM" name="대표노선명" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
				<w2:dataList baseNode="list" repeatNode="map" id="dlt_searchitem2" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="DAY_DIV" name="name1" dataType="text"></w2:column>
						<w2:column id="ROUT_NM" name="name2" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
				<w2:dataList baseNode="list" repeatNode="map" id="dlt_BRT_OPER_PL_MST" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="REP_ROUT_ID" name="대표노선ID" dataType="text"></w2:column>
						<w2:column id="REP_ROUT_NM" name="대표노선명" dataType="text"></w2:column>
						<w2:column id="DAY_DIV" name="요일구분" dataType="text"></w2:column>
						<w2:column id="WAY_DIV" name="상하행구분" dataType="text"></w2:column>
						<w2:column id="ST_STTN_NM" name="시작정류소" dataType="text"></w2:column>
						<w2:column id="ED_STTN_NM" name="종료정류소" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
				<w2:dataMap baseNode="map" id="dma_param_AL0305G1">
					<w2:keyInfo>
						<w2:key id="REP_ROUT_ID" name="대표노선ID" dataType="text"></w2:key>
						<w2:key id="REP_ROUT_NM" name="대표노선명" dataType="text"></w2:key>
						<w2:key id="DAY_DIV" name="요일구분" dataType="text"></w2:key>
						<w2:key id="WAY_DIV" name="상하행구분" dataType="text"></w2:key>
						<w2:key id="F_DATE" name="운행일" dataType="text"></w2:key>
						<w2:key id="L_DATE" name="운행일" dataType="text"></w2:key>
						<w2:key id="relDt" name="배포일" dataType="text"></w2:key>
						<w2:key id="REL_WAY" name="배포방법" dataType="text"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataList baseNode="list" repeatNode="map" id="dlt_BRT_ALLOC_PL_MST" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="OPER_DT" name="운행일" dataType="date"></w2:column>
						<w2:column id="REP_ROUT_ID" name="대표노선ID" dataType="text"></w2:column>
						<w2:column id="ALLOC_NO" name="배차번호" dataType="text"></w2:column>
						<w2:column id="DAY_DIV" name="요일구분" dataType="text"></w2:column>
						<w2:column id="WAY_DIV" name="상하행구분" dataType="text"></w2:column>
						<w2:column id="VHC_ID" name="차량ID" dataType="text"></w2:column>
						<w2:column id="VHC_NO" name="차량번호" dataType="text"></w2:column>
						<w2:column id="COMP_NM" name="운수사명" dataType="text"></w2:column>
						
						<w2:column id="DRV_NM" name="운전자명" dataType="text"></w2:column>
						<w2:column id="SEC_DRV_NM" name="2교대운전자명" dataType="text"></w2:column>
						<w2:column id="THR_DRV_NM" name="3교대운전자명" dataType="text"></w2:column>
						<w2:column id="DRV_ID" name="운전자ID" dataType="text"></w2:column>
						<w2:column id="SEC_DRV_ID" name="2교대운전자ID" dataType="text"></w2:column>
						<w2:column id="THR_DRV_ID" name="3교대운전자ID" dataType="text"></w2:column>
						<w2:column id="SEC_TRAN_TM" name="2교대시각" dataType="text"></w2:column>
						<w2:column id="THR_TRAN_TM" name="3교대시각" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
				<w2:dataList baseNode="list" repeatNode="map" id="dlt_BRT_OPER_DT_ALLOC_PL_MST" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="OPER_DT" name="운행일" dataType="date"></w2:column>
						<w2:column id="REP_ROUT_ID" name="대표노선ID" dataType="text"></w2:column>
						<w2:column id="ALLOC_NO" name="배차번호" dataType="text"></w2:column>
						<w2:column id="DAY_DIV" name="요일구분" dataType="text"></w2:column>
						<w2:column id="WAY_DIV" name="요일구분" dataType="text"></w2:column>
						<w2:column id="VHC_ID" name="차량ID" dataType="text"></w2:column>
						<w2:column id="VHC_NO" name="차량번호" dataType="text"></w2:column>
						<w2:column id="COMP_NM" name="운수사명" dataType="text"></w2:column>
						<w2:column id="SEC_VHC_ID" name="2교대차량ID" dataType="text"></w2:column>
						<w2:column id="SEC_VHC_NO" name="2교대차량번호" dataType="text"></w2:column>
						<w2:column id="SEC_COMP_NM" name="2교대운수사명" dataType="text"></w2:column>
						<w2:column id="DRV_NM" name="운전자명" dataType="text"></w2:column>
						<w2:column id="SEC_DRV_NM" name="2교대운전자명" dataType="text"></w2:column>
						<w2:column id="THR_DRV_NM" name="3교대운전자명" dataType="text"></w2:column>
						<w2:column id="DRV_ID" name="운전자ID" dataType="text"></w2:column>
						<w2:column id="SEC_DRV_ID" name="2교대운전자ID" dataType="text"></w2:column>
						<w2:column id="THR_DRV_ID" name="3교대운전자ID" dataType="text"></w2:column>
						<w2:column id="SEC_TRAN_TM" name="2교대시각" dataType="text"></w2:column>
						<w2:column id="THR_TRAN_TM" name="3교대시각" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
			</w2:dataCollection>
			<w2:workflowCollection></w2:workflowCollection>
			<!--  <xf:submission id="sub_AL0305G0R0" ref="data:json,dma_search" target='data:json,dlt_BRT_OPER_PL_MST' action="/al/AL0305G0R0"
				method="post" mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous"
				processMsg="조회 중입니다..." ev:submit="" ev:submitdone="scwin.sub_AL0305G0R0_submitdone" ev:submiterror="" abortTrigger="">
			</xf:submission>
			
			<xf:submission id="sub_AL0305G1R0" ref="data:json,dma_param_AL0305G1" target='data:json,dlt_BRT_ALLOC_PL_MST'
				action="/al/AL0305G1R0" method="post" mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler=""
				customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sub_AL0305G1R0_submitdone" ev:submiterror=""
				abortTrigger="">
			</xf:submission>
			<xf:submission id="sub_AL0305G1S0" ref='data:json,{"action":"modified","id":"dlt_BRT_ALLOC_PL_MST"}'
				target="data:json,dma_result" action="/al/AL0305G1S0" method="post" mediatype="application/json" encoding="UTF-8" instance="" replace=""
				errorHandler="" customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sub_AL0305G1S0_submitdone"
				ev:submiterror="" abortTrigger="">
			</xf:submission>
			<xf:submission id="sub_AL0305SHI1" ref="data:json,dma_search" target="data:json,dlt_searchitem2" action="/al/AL0305SHI1"
				method="post" mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous"
				processMsg="" ev:submit="" ev:submitdone="scwin.sub_AL0305SHI1_submitdone" ev:submiterror="" abortTrigger="">
			</xf:submission>-->
			<xf:submission id="sub_AL0305G0R0" ref="data:json,dma_param_AL0305G1" target="data:json,dlt_BRT_OPER_DT_ALLOC_PL_MST"
				action="/al/AL0305G0R0" method="post" mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler=""
				customHandler="" mode="asynchronous" processMsg="조회중입니다..." ev:submit="" ev:submitdone="scwin.sub_AL0305G0R0_submitdone"
				ev:submiterror="" abortTrigger="">
			</xf:submission>
			<xf:submission id="sub_AL0305G0S0" ref='data:json,{"action":"modified","id":"dlt_BRT_OPER_DT_ALLOC_PL_MST"}'
				target="data:json,dma_result" action="/al/AL0305G0S0" method="post" mediatype="application/json" encoding="UTF-8" instance="" replace=""
				errorHandler="" customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sub_AL0305G0S0_submitdone"
				ev:submiterror="" abortTrigger="">
			</xf:submission>
			<xf:submission id="sub_AL0305G0SEND" ref='data:json,{"action":"modified","id":"dlt_BRT_OPER_DT_ALLOC_PL_MST"}'
				target="data:json,dma_result" action="/al/AL0305G0SEND" method="post" mediatype="application/json" encoding="UTF-8" instance="" replace=""
				errorHandler="" customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sub_AL0305G0SEND_submitdone"
				ev:submiterror="" abortTrigger="">
			</xf:submission>
			<xf:submission id="sub_AL0305SHI0" ref="" target="data:json,dlt_repRoutItem" action="/repRout/selectRepRoutItem" method="post"
				mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" processMsg=""
				ev:submit="" ev:submitdone="scwin.sub_AL0305SHI0_submitdone" ev:submiterror="" abortTrigger="">
			</xf:submission>
			<!--  <xf:submission id="sub_AL0305G1S1" ref='data:json,["dma_param_AL0305G1","dlt_BRT_ALLOC_PL_MST"]'
				target="data:json,dma_result" action="/al/AL0305G1S1" method="post" mediatype="application/json" encoding="UTF-8" instance="" replace=""
				errorHandler="" customHandler="" mode="asynchronous" processMsg="저장중입니다..." ev:submit="" ev:submitdone="scwin.sub_AL0305G1S1_submitdone" ev:submiterror="" abortTrigger="">
			</xf:submission>-->
		</xf:model>
		<script type="text/javascript" lazy="false"><![CDATA[
        
	scwin.onpageload = function() {
		var autoOptions = {
			Main : { grid : AL0305G0, srchSbm : sub_AL0305G0R0, savSbm : sub_AL0305G0S0, srchGrp : pgm_search , keyColumn : "REP_ROUT_ID", focusColumn : "OPER_DT", name : "차량배차 일별 목록"}
			//Sub2 : { grid : AL0305G1, srchSbm : sub_AL0305G1R0, keyColumn : "ALLOC_NO", savSbm : sub_AL0305G1S0, name : "차량 배차(마스터)" },
			//Sub1 : { grid : AL0305G0, srchSbm : sub_AL0305G0R0, keyColumn : "ALLOC_NO", savSbm : sub_AL0305G0S0, name : "차량 배차(일)" }	
		 };
		 
		var mainOptions = {
		 	ADD:{disp:"hide"},
			//ADD: {cbFnc:scwin.btn_distri_onclick, nm:"배포", class : "setting"},
			DEL: {disp:"hide"},
			EXL:scwin.btn_excel_onclick,
			SETTING:{cbFnc:scwin.direct_reflec_onclick, nm:"즉시반영", class : "setting"},
			SEARCH:{}
		}
		var codeOptions = [ {code : "DAY_DIV", compID : "AL0305G0:DAY_DIV" }
			,{code : "WAY_DIV", compID : "AL0305G0:WAY_DIV" }
		];
		com.setMainBtn2(wfm_mainBtn, gcm.DISP_TYPE.SINGLE_GRID, autoOptions, mainOptions, codeOptions);		
		var mainSrhOptions = {
		};		
		com.setMainSrhBtn(wfm_mainSearchBtn, gcm.DISP_TYPE.SINGLE_GRID, autoOptions, mainSrhOptions, codeOptions);
		/*var subOptions = {
			//SAVE: {mode:"auto"},
			SAVE: {cbFnc:scwin.btn_modify_onclick, nm:"저장",class:"save"},
			CNL: {mode:"auto"}
		};
		
		com.setSubBtn2(wfm_subBtn, autoOptions, subOptions);*/
		
	
		dma_param_AL0305G1.F_DATE = util.getCurrentDate2();
		F_DATE.setValue(util.getCurrentDate2());
		
		dma_param_AL0305G1.L_DATE = util.getCurrentDate2();
		L_DATE.setValue(util.getCurrentDate2(7));
		
		TYPE1.setValue('RR00000002');
		
		dma_param_AL0305G1.set("REP_ROUT_ID", 'RR00000002')
		dma_param_AL0305G1.set("F_DATE", F_DATE.getValue())
		dma_param_AL0305G1.set("L_DATE", L_DATE.getValue())
		
		com.setCommonDtl(codeOptions, function() {
			com.searchGrid(AL0305G0, sub_AL0305G0R0);
		});	
		
		com.executeSubmission(sub_AL0305SHI0);
		
		AL0305G0.mergeCells("byrestriccol");
	};
	
	scwin.onpageunload = function() {
		
	};
	
	//즉시반영 클릭 이벤트
	scwin.direct_reflec_onclick = function(){
		com.confirm("운영에 즉시 반영 하시겠습니까?", function(rtn) {
			if (rtn) {
				com.executeSubmission(sub_AL0305G0SEND);
			}
		});
	};
	
	//엑셀 다운로드
	scwin.btn_excel_onclick = function() {
		var str = TYPE1.getText() + " - 배차 일별 관리표";
		var options = {
			fileName : str+".xls", //[defalut: excel.xlsx] 다운로드하려는 파일의 이름으로 필수 입력 값 (지원하는 타입 => xls, xlsx, csv)
			fileType : "xls",
			useFooter : true
		};
		var infoArr = {};
		com.gridDataDownLoad(AL0305G0, options, infoArr);
	
	};
	
	//배포
	scwin.btn_distri_onclick = function(){
		var jsondata = dlt_BRT_ALLOC_PL_MST.getAllJSON();
		var dayDiv = dlt_BRT_OPER_PL_MST.getCellData(AL0305G0.getFocusedRowIndex(), "DAY_DIV");
		var allJson = dlt_BRT_ALLOC_PL_MST.getAllJSON();
		
		var data = {data : jsondata, DAYDIV : dayDiv, allJson : allJson, callbackFn : "scwin.AL0305P0_callbackFn"};
		if(jsondata.length > 0){
			var options = { id : "AL0305P01",
							popupName : "배포 날짜",
							width : 1500,
							heigth : 200,
							modal : true};
			com.openPopup("/ui/BRT/AL0305/AL0305P01.xml", options, data);
		}
		
		/*var startDateValue = REL_DATE_F.getValue();
		var lastDateValue = REL_DATE_L.getValue();
		
		var startDate = startDateValue.slice(0,4) + '-' + startDateValue.slice(4, 6) + '-' + startDateValue.slice(6,8)
		var lastDate = lastDateValue.slice(0,4) + '-' + lastDateValue.slice(4, 6) + '-' + lastDateValue.slice(6,8)
		
		//var regex = RegExp(/^\d{4}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/);
		//if(!(regex.test(startDate) && regex.test(lastDate))) return "Not Date Format";
		var relDt = [];
		var curDate = new Date(startDate);
		while(curDate <= new Date(lastDate)) {
			relDt.push(curDate.toISOString().split("T")[0]);
			curDate.setDate(curDate.getDate() + 1);
		}
		
		dma_param_AL0305G1.set("relDt", relDt);
		
		if(dma_param_AL0305G1.get("relDt").length != 0){
			com.executeSubmission(sub_AL0305G1S1);
		}else{
			com.messagBox("alert", "배포일을 선택해주세요.");
		}*/
		
	}
	
	scwin.AL0305P0_callbackFn = function(popup_param){
		var week = ['일', '월', '화', '수', '목', '금', '토']; 
		var dayDiv = dlt_BRT_OPER_PL_MST.getCellData(AL0305G0.getFocusedRowIndex(), "DAY_DIV");
		var startDateValue = popup_param[0].toString().substring(0, 8);
		var lastDateValue = popup_param[0].toString().substring(8);
		
		var startDate = startDateValue.slice(0,4) + '-' + startDateValue.slice(4, 6) + '-' + startDateValue.slice(6,8)
		var lastDate = lastDateValue.slice(0,4) + '-' + lastDateValue.slice(4, 6) + '-' + lastDateValue.slice(6,8)
		
		//var regex = RegExp(/^\d{4}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/);
		//if(!(regex.test(startDate) && regex.test(lastDate))) return "Not Date Format";
		var relDt = [];
		var curDate = new Date(startDate);
		while(curDate <= new Date(lastDate)) {
			var dayOfWeek = week[new Date(curDate).getDay()];
			
			if(dayDiv == 'DY001'){
				if(dayOfWeek != '토' && dayOfWeek != '일'){
					relDt.push(curDate.toISOString().split("T")[0]);
					curDate.setDate(curDate.getDate() + 1);
				}else{
					curDate.setDate(curDate.getDate() + 1);
				}
			}else if(dayDiv == 'DY002'){
				if(dayOfWeek == '토' || dayOfWeek == '일'){
					relDt.push(curDate.toISOString().split("T")[0]);
					curDate.setDate(curDate.getDate() + 1);
				}else{
					curDate.setDate(curDate.getDate() + 1);
				}
			}
		}
		dma_param_AL0305G1.set("relDt", relDt);
		dma_param_AL0305G1.set("REL_WAY", popup_param[2]);
		
		dlt_BRT_ALLOC_PL_MST.setJSON(popup_param[1]);
		if(dma_param_AL0305G1.get("relDt").length != 0){
			com.executeSubmission(sub_AL0305G1S1);
		}else{
			com.messagBox("alert", "배포일을 선택해주세요.");
		}
	}
	
	//수정
	scwin.btn_modify_onclick = function(){
		com.executeSubmission(sub_AL0305G0S0);
	}
	
	scwin.sub_AL0305G0R0_submitdone = function(e) {
		
		com.setFocusedCell(AL0305G0, "DAY_DIV");
	};
	
	scwin.sub_AL0305G1R0_submitdone = function(e) {
		
		com.setFocusedCell(AL0305G1, "VHC_NO");	
	};
	
	scwin.AL0305G0_onrowindexchange = function(row,oldRow) {
		/*var operDt = dlt_BRT_OPER_DT_ALLOC_PL_MST.getCellData(row, 'OPER_DT');
		operDt = new Date(operDt);
		var today = new Date();
		
		if(operDt < today){
			AL0305G0.setReadOnly("row", row, true);
		}
		
		//지난 배차는 수정 못하게 
		if((operDt.getFullYear() < today.getFullYear()) || (operDt.getMonth()+1 <= today.getMonth()+1 && operDt.getDate() < today.getDate())){
			AL0305G0.setReadOnly("row", row, true);
		}*/
		
	};
	
	scwin.sub_AL0305G1S0_submitdone = function(e) {
		com.saveDone(AL0305G1, sub_AL0305G1R0);		
	};
	
	scwin.AL0305G0_ontextimageclick = function(row,col) {
		var repRoutId = dma_param_AL0305G1.get("REP_ROUT_ID");
		var operDt = dlt_BRT_OPER_DT_ALLOC_PL_MST.getCellData(row, 'OPER_DT');
		operDt = new Date(operDt);
		var today = new Date();
		var str = "지난 날짜입니다. 수정 하시겠습니까?";
		
		if(col == 3){
			if((operDt.getFullYear() < today.getFullYear()) || (operDt.getMonth()+1 <= today.getMonth()+1 && operDt.getDate() < today.getDate())){
				com.alert("지난 날짜입니다.");
				
				/*com.confirm(str, function(rtn) {
				if (rtn) {
						var vhcId = [];
						var rowCnt = dlt_BRT_OPER_DT_ALLOC_PL_MST.getRowCount();
						var jsonData = dlt_BRT_OPER_DT_ALLOC_PL_MST.getAllJSON();
						for(var x = 0; x < rowCnt; x++){
							vhcId.push(jsonData[x].VHC_ID);
						};
						var data = { data: repRoutId, vhcId:vhcId,callbackFn : "scwin.searchVhcCallbackG2" };
								   	 
						var opt = { id : "popUpAllocVhcList", 
									popupName : "차량번호 검색",
									//width : 600,
									//height : 500,
									modal : true};
						com.openPopup("/cm//common/popUpAllocVhcList.xml", opt, data);
					}
				});*/
			}else{
				
				var vhcId = [];
				var rowCnt = dlt_BRT_OPER_DT_ALLOC_PL_MST.getRowCount();
				var jsonData = dlt_BRT_OPER_DT_ALLOC_PL_MST.getAllJSON();
				for(var x = 0; x < rowCnt; x++){
					vhcId.push(jsonData[x].VHC_ID);
				};
				var data = { data: repRoutId, vhcId:vhcId,callbackFn : "scwin.searchVhcCallbackG2" };
						   	 
				var opt = { id : "popUpAllocVhcList", 
							popupName : "차량번호 검색",
							//width : 600,
							//height : 500,
							modal : true};
				com.openPopup("/cm//common/popUpAllocVhcList.xml", opt, data);
				
			}
			
				
		}
		else if(col == 5){
			if((operDt.getFullYear() < today.getFullYear()) || (operDt.getMonth()+1 <= today.getMonth()+1 && operDt.getDate() < today.getDate())){
				com.alert("지난 날짜입니다.");
				
				/*com.confirm(str, function(rtn) {
				if (rtn) {
						var drvId = [];
						var rowCnt = dlt_BRT_OPER_DT_ALLOC_PL_MST.getRowCount();
						var jsonData = dlt_BRT_OPER_DT_ALLOC_PL_MST.getAllJSON();
						for(var x = 0; x < rowCnt; x++){
							drvId.push(jsonData[x].DRV_ID);
						};
						var data = { data:repRoutId, drvId:drvId, callbackFn : "scwin.searchDrvCallbackG2" };
								   	 
						var opt = { id : "popUpDrvList", 
									popupName : "운전자 검색",
									//width : 600,
									//height : 500,
									modal : true};
						com.openPopup("/cm//common/popUpDrvList.xml", opt, data);
					}
				});*/
			}else{
				var drvId = [];
				var rowCnt = dlt_BRT_OPER_DT_ALLOC_PL_MST.getRowCount();
				var jsonData = dlt_BRT_OPER_DT_ALLOC_PL_MST.getAllJSON();
				for(var x = 0; x < rowCnt; x++){
					drvId.push(jsonData[x].DRV_ID);
				};
				var data = { data:repRoutId, drvId:drvId, callbackFn : "scwin.searchDrvCallbackG2" };
						   	 
				var opt = { id : "popUpDrvList", 
							popupName : "운전자 검색",
							//width : 600,
							//height : 500,
							modal : true};
				com.openPopup("/cm//common/popUpDrvList.xml", opt, data);
			
			}
		}
		else if(col == 6){
			if((operDt.getFullYear() < today.getFullYear()) || (operDt.getMonth()+1 <= today.getMonth()+1 && operDt.getDate() < today.getDate())){
				com.alert("지난 날짜입니다.");
				
				/*com.confirm(str, function(rtn) {
				if (rtn) {
						var drvId = [];
						var rowCnt = dlt_BRT_OPER_DT_ALLOC_PL_MST.getRowCount();
						var jsonData = dlt_BRT_OPER_DT_ALLOC_PL_MST.getAllJSON();
						for(var x = 0; x < rowCnt; x++){
							drvId.push(jsonData[x].DRV_ID);
						};
						var data = { data:repRoutId, drvId:drvId, callbackFn : "scwin.searchDrv2CallbackG2" };
								   	 
						var opt = { id : "popUpDrvList", 
									popupName : "운전자 검색",
									//width : 600,
									//height : 500,
									modal : true};
						com.openPopup("/cm//common/popUpDrvList.xml", opt, data);
					}
				});*/
			}else{
				var vhcId = [];
				var rowCnt = dlt_BRT_OPER_DT_ALLOC_PL_MST.getRowCount();
				var jsonData = dlt_BRT_OPER_DT_ALLOC_PL_MST.getAllJSON();
				for(var x = 0; x < rowCnt; x++){
					vhcId.push(jsonData[x].SEC_VHC_ID);
				};
				var data = { data: repRoutId, vhcId:vhcId,callbackFn : "scwin.searchVhc2CallbackG2" };
						   	 
				var opt = { id : "popUpAllocVhcList", 
							popupName : "차량번호 검색",
							//width : 600,
							//height : 500,
							modal : true};
				com.openPopup("/cm//common/popUpAllocVhcList.xml", opt, data);
			
			}
		}
		else if(col == 8){
			if((operDt.getFullYear() < today.getFullYear()) || (operDt.getMonth()+1 <= today.getMonth()+1 && operDt.getDate() < today.getDate())){
				com.alert("지난 날짜입니다.");
				
				/*com.confirm(str, function(rtn) {
				if (rtn) {
						var drvId = [];
						var rowCnt = dlt_BRT_OPER_DT_ALLOC_PL_MST.getRowCount();
						var jsonData = dlt_BRT_OPER_DT_ALLOC_PL_MST.getAllJSON();
						for(var x = 0; x < rowCnt; x++){
							drvId.push(jsonData[x].DRV_ID);
						};
						var data = { data:repRoutId, drvId:drvId, callbackFn : "scwin.searchDrv3CallbackG2" };
								   	 
						var opt = { id : "popUpDrvList", 
									popupName : "운전자 검색",
									//width : 600,
									//height : 500,
									modal : true};
						com.openPopup("/cm//common/popUpDrvList.xml", opt, data);
					}
				});*/
			}else{
				var drvId = [];
				var rowCnt = dlt_BRT_OPER_DT_ALLOC_PL_MST.getRowCount();
				var jsonData = dlt_BRT_OPER_DT_ALLOC_PL_MST.getAllJSON();
				for(var x = 0; x < rowCnt; x++){
					drvId.push(jsonData[x].SEC_DRV_ID);
				};
				var data = { data:repRoutId, drvId:drvId, callbackFn : "scwin.searchDrv2CallbackG2" };
						   	 
				var opt = { id : "popUpDrvList", 
							popupName : "운전자 검색",
							//width : 600,
							//height : 500,
							modal : true};
				com.openPopup("/cm//common/popUpDrvList.xml", opt, data);
			
			}
		}
	};
	
	
	
	//찾기 버튼 콜백함수
	scwin.searchVhcCallbackG2 = function(obj) {
		var vhcId =obj[0].VHC_ID;
		var vhcNo =obj[0].VHC_NO;
		var compNm =obj[0].COMP_NM;
		
		dlt_BRT_OPER_DT_ALLOC_PL_MST.setCellData(AL0305G0.getFocusedRowIndex(), "VHC_ID", vhcId);
		dlt_BRT_OPER_DT_ALLOC_PL_MST.setCellData(AL0305G0.getFocusedRowIndex(), "VHC_NO", vhcNo);
		dlt_BRT_OPER_DT_ALLOC_PL_MST.setCellData(AL0305G0.getFocusedRowIndex(), "COMP_NM", compNm);
	};
	
	//찾기 버튼 콜백함수
	scwin.searchVhc2CallbackG2 = function(obj) {
		var vhcId =obj[0].VHC_ID;
		var vhcNo =obj[0].VHC_NO;
		var compNm =obj[0].COMP_NM;
		
		dlt_BRT_OPER_DT_ALLOC_PL_MST.setCellData(AL0305G0.getFocusedRowIndex(), "SEC_VHC_ID", vhcId);
		dlt_BRT_OPER_DT_ALLOC_PL_MST.setCellData(AL0305G0.getFocusedRowIndex(), "SEC_VHC_NO", vhcNo);
		dlt_BRT_OPER_DT_ALLOC_PL_MST.setCellData(AL0305G0.getFocusedRowIndex(), "SEC_COMP_NM", compNm);
	};
	
	//찾기 버튼 콜백함수
	scwin.searchDrvCallbackG2 = function(obj) {
		var drvId =obj[0].DRV_ID;
		var drvNm =obj[0].DRV_NM;
		
		dlt_BRT_OPER_DT_ALLOC_PL_MST.setCellData(AL0305G0.getFocusedRowIndex(), "DRV_ID", drvId);
		dlt_BRT_OPER_DT_ALLOC_PL_MST.setCellData(AL0305G0.getFocusedRowIndex(), "DRV_NM", drvNm);
	};
	
	//찾기 버튼 콜백함수
	scwin.searchDrv2CallbackG2 = function(obj) {
		var drvId =obj[0].DRV_ID;
		var drvNm =obj[0].DRV_NM;
		
		dlt_BRT_OPER_DT_ALLOC_PL_MST.setCellData(AL0305G0.getFocusedRowIndex(), "SEC_DRV_ID", drvId);
		dlt_BRT_OPER_DT_ALLOC_PL_MST.setCellData(AL0305G0.getFocusedRowIndex(), "SEC_DRV_NM", drvNm);
	};
	
	//찾기 버튼 콜백함수
	scwin.searchDrv3CallbackG2 = function(obj) {
		var drvId =obj[0].DRV_ID;
		var drvNm =obj[0].DRV_NM;
		
		dlt_BRT_OPER_DT_ALLOC_PL_MST.setCellData(AL0305G0.getFocusedRowIndex(), "THR_DRV_ID", drvId);
		dlt_BRT_OPER_DT_ALLOC_PL_MST.setCellData(AL0305G0.getFocusedRowIndex(), "THR_DRV_NM", drvNm);
	};
	
	scwin.sub_AL0305SHI0_submitdone = function(e) {
		TYPE1.setValue('RR00000002');
		//com.setFocusedCell(AL0305G0, "DAY_DIV");
	};
	
	scwin.TYPE1_onviewchange = function(info) {
		//startMarker = 1;
		dma_param_AL0305G1.set("REP_ROUT_ID", info.newValue);
		com.executeSubmission(sub_AL0305G0R0);
	};
	
	scwin.sub_AL0305SHI1_submitdone = function(e) {
		
		com.executeSubmission(sub_AL0305G0R0);
	};
	
	scwin.TYPE2_onviewchange = function(info) {
		//startMarker = 1;
		dma_param_AL0305G1.set("DAY_DIV", info.newValue);
		com.executeSubmission(sub_AL0305G0R0);
	};
	
	scwin.F_DATE_onviewchange = function(info) {
		var ldate = L_DATE.getValue();
		var fdate = F_DATE.getValue();
		calendar_radio.setValue("DIRECT");
		if (fdate > ldate && ldate != ""){
			com.messagBox("alert", "지정할 수 없는 날짜입니다.",scwin.checkCLoseF(info));
		}
	};
	
	scwin.checkCLoseF = function(info) {
		F_DATE.setValue(info.oldValue);
	};
	
	scwin.L_DATE_onviewchange = function(info) {
		var ldate = L_DATE.getValue();
		var fdate = F_DATE.getValue();
		calendar_radio.setValue("DIRECT");
		if (fdate > ldate){
			com.messagBox("alert", "지정할 수 없는 날짜입니다.",scwin.checkCLoseL(info));
		}
	};
	
	scwin.checkCLoseL = function(info) {
		L_DATE.setValue(info.oldValue);
	};
	
	scwin.sub_AL0305G0R0_submitdone = function(e) {
		com.setFocusedCell(AL0305G0, "VHC_NO");
	};
	
	scwin.sub_AL0305G0S0_submitdone = function(e) {
		com.saveDone(AL0305G0, sub_AL0305G0R0);
	};
	
	scwin.sub_AL0305G0S0_submitdone = function(e) {
		
	};
	
	
	scwin.sub_AL0305G1S1_submitdone = function(e) {
		com.saveDone(AL0305G1, sub_AL0305G1R0);
	};
	
	//라디오 버튼에 따라 날짜 설정
	scwin.calendar_radio_onviewchange = function(info) {
		com.setCalendarRadioChange(F_DATE, L_DATE, info);
	};
	
	
	scwin.AL0305G0_oncelldblclick = function(row,col,colId) {
		/*var operDt = dlt_BRT_OPER_DT_ALLOC_PL_MST.getCellData(row, 'OPER_DT');
		operDt = new Date(operDt);
		var today = new Date();
		var str = "지난 날짜입니다. 수정 하시겠습니까?";
		
		if(colId == "SEC_TRAN_TM" || colId == "THR_TRAN_TM"){
			if((operDt.getFullYear() < today.getFullYear()) || (operDt.getMonth()+1 <= today.getMonth()+1 && operDt.getDate() < today.getDate())){
				com.confirm(str, function(rtn) {
				if (rtn) {
						
					}
				});
			}
		}*/
	};
	]]></script>
    </head>
	<body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">
		<xf:group id="pgm_container" class="pgm_container grdr_60_a" style="">
		
			<xf:group id="" class="grdc_2f_8f title-wrap" style="">
				<xf:group id="pgm_header_left" class="pgm_header_left" style="">
					<w2:wframe id="wfm_title" style="" src="/cm/common/wf_title.xml" scope="true"></w2:wframe>
				</xf:group>
				<xf:group id="pgm_header_right" class="pgm_header_right" style="">
					<xf:group id="pgm_rightNavi" class="pgm_rightNavi" style="">
						<w2:wframe id="rightNavi" class="" style="" src="/cm/common/wf_rightNavi.xml" scope="true"></w2:wframe>
					</xf:group>
					<xf:group id="pgm_header" class="pgm_header" style="">
						<w2:wframe id="wfm_mainBtn" class="main_Btn" style="float:right" src="/cm/common/wf_mainBtn.xml" scope="true"></w2:wframe>
					</xf:group>
				</xf:group>
			</xf:group>
		
			<xf:group id="pgm_content" class="pgm_content grdc_a" style="">
				<xf:group id="pgm_list" class="pgm_list grdr_20_50_a bms_box_wrap" style="">
					<xf:group id="" class="" style="">
						<xf:group class="defaultbox" id="" style="">
							<w2:textbox class="df_tt fl list ico-list" id="" label="차량배차 일별 목록" style=""></w2:textbox>
						</xf:group>
					</xf:group>
					
					<xf:group id="" class="" style="">
						<xf:group id="" style="" class="gr_search">
							<xf:group id="" style="" class="label">
									<w2:span id="" class="" label="검색 항목"></w2:span>
							</xf:group>
							<xf:group class="search" id="pgm_search" style="">
							<xf:select1 allOption="" appearance="minimal" chooseOption="" direction="auto" disabled="false"
								disabledClass="w2selectbox_disabled" displayMode="label" ev:onviewchange="scwin.TYPE1_onviewchange" id="TYPE1" optionOrder="false"
								ref="data:dma_search.CONTENT1" class="search_type_100" style="" submenuSize="auto" textAlign="left" chooseOptionLabel="전체">
								<xf:choices>
									<xf:itemset nodeset="data:dlt_repRoutItem">
										<xf:label ref="REP_ROUT_NM"></xf:label>
										<xf:value ref="REP_ROUT_ID"></xf:value>
									</xf:itemset>
								</xf:choices>
							</xf:select1>
							<!-- <xf:group class="label" id="" style="">
									<w2:span class="" id="" label="요일 구분"></w2:span>
								</xf:group>
							<xf:select1 allOption="" appearance="minimal" chooseOption="" direction="auto" disabled="false"
								disabledClass="w2selectbox_disabled" displayMode="label" ev:onviewchange="scwin.TYPE2_onviewchange" id="TYPE2" optionOrder="false"
								ref="data:dma_search.CONTENT2" class="search_type_100" style="" submenuSize="auto" textAlign="left" chooseOptionLabel="-전체-">
								<xf:choices>
									<xf:item>
										<xf:label><![CDATA[평일]]></xf:label>
										<xf:value><![CDATA[DY001]]></xf:value>
									</xf:item>
									<xf:item>
										<xf:label><![CDATA[휴일]]></xf:label>
										<xf:value><![CDATA[DY002]]></xf:value>
									</xf:item>
								</xf:choices>
							</xf:select1> -->
							<xf:group class="label" id="" style="">
									<w2:span class="" id="" label="기간" style="margin-left: 10px;"></w2:span>
								</xf:group>
								<w2:inputCalendar footerDiv="false" rightAlign="false" focusOnDateSelect="false"
									style="width:120px; margin-right: 10px; margin-top: 3px; float:left;" id="F_DATE" renderType="component" renderDiv="true"
									calendarValueType="yearMonthDate" ref="data:dma_param_AL0305G1.F_DATE" ev:onviewchange="scwin.F_DATE_onviewchange" placeholder="yyyymmdd">
								</w2:inputCalendar>
								<xf:group class="label" id="" style="">
									<w2:span class="" id="" label="~" style=""></w2:span>
								</xf:group>
								<w2:inputCalendar footerDiv="false" rightAlign="false" focusOnDateSelect="false"
									style="width:120px; margin-right: 10px; margin-top: 3px; float:left;" id="L_DATE" renderType="component" renderDiv="true"
									calendarValueType="yearMonthDate" ref="data:dma_param_AL0305G1.L_DATE" ev:onviewchange="scwin.L_DATE_onviewchange" placeholder="yyyymmdd">
								</w2:inputCalendar>
								<xf:group id="" style="margin-left: 10px;" class="radio">
									<xf:select1 id="calendar_radio" ref="" selectedIndex="2" cols="" appearance="full"
										style="min-width: 200px;" rows="1" ev:onviewchange="scwin.calendar_radio_onviewchange">
										<xf:choices>
											<xf:item>
												<xf:label><![CDATA[직접입력]]></xf:label>
												<xf:value><![CDATA[DIRECT]]></xf:value>
											</xf:item>
											<xf:item>
												<xf:label><![CDATA[금일]]></xf:label>
												<xf:value><![CDATA[TODAY]]></xf:value>
											</xf:item>
											<xf:item>
												<xf:label><![CDATA[일주일]]></xf:label>
												<xf:value><![CDATA[WEEK]]></xf:value>
											</xf:item>
											<xf:item>
												<xf:label><![CDATA[1개월]]></xf:label>
												<xf:value><![CDATA[MONTH]]></xf:value>
											</xf:item>
										</xf:choices>
									</xf:select1>
								</xf:group>
							</xf:group>
							<w2:wframe id="wfm_mainSearchBtn" class="wfm_mainSearchBtn" style="" src="/cm/common/wf_mainSrhBtn.xml" scope="true"></w2:wframe>							
						</xf:group>
					</xf:group>
				
					<xf:group id="" class="" style="">
						<w2:gridView ignoreCellClick="false" ev:onrowindexchange="scwin.AL0305G0_onrowindexchange" autoFit="lastColumn" rowNumHeaderValue="No."
							visibleRowNum="" class="cm_grid right" fixedColumnWithHidden="true" rowNumVisible="false"
							dataList="data:dlt_BRT_OPER_DT_ALLOC_PL_MST" id="AL0305G0" readOnly="false" style="" useShiftKey="true" scrollByColumn="false"
							rowStatusVisible="false" rowStatusHeaderValue="상태" ev:oncellclick="" focusMode="cell"
							ev:ontextimageclick="scwin.AL0305G0_ontextimageclick" ev:oncelldblclick="scwin.AL0305G0_oncelldblclick">
							<w2:caption style="" id="caption1" value="this is a grid caption."></w2:caption>
							<w2:header style="" id="header1">
								<w2:row style="" id="row3">
									<w2:column removeBorderStyle="false" width="80" inputType="text" style="height:20px;" id="column20"
										value="날짜" blockSelect="false" displayMode="label" colSpan="" rowSpan="2">
									</w2:column>
									<w2:column removeBorderStyle="false" width="70" inputType="text" style="height:40px;" id="column19"
										value="배차번호" blockSelect="false" displayMode="label" colSpan="" rowSpan="2">
									</w2:column>
									<w2:column removeBorderStyle="false" width="70" inputType="text" style="height:40px;" id="column1"
										value="상하행" blockSelect="false" displayMode="label" colSpan="" rowSpan="2">
									</w2:column>
									<w2:column removeBorderStyle="false" width="100" inputType="text" style="height:20px;" id="column16"
										value="오전" blockSelect="false" displayMode="label" colSpan="3">
									</w2:column>
									<w2:column removeBorderStyle="false" width="200" inputType="text" style="height:20px;" id="column15"
										value="오후" blockSelect="false" displayMode="label" colSpan="4" rowSpan="">
									</w2:column>
									<w2:column removeBorderStyle="false" width="200" inputType="text" style="height:20px;" id="column13"
										value="" blockSelect="false" displayMode="label" colSpan="1" rowSpan="2">
									</w2:column>
								</w2:row>
								<w2:row style="" id="row1">
									<w2:column removeBorderStyle="false" width="100" inputType="text" style="height:40px;" id="column18"
										value="차량번호" blockSelect="false" displayMode="label" colSpan="" >
									</w2:column>
									<w2:column removeBorderStyle="false" width="150" inputType="text" style="height:40px;" id="column17"
										value="운수사" blockSelect="false" displayMode="label" colSpan="" >
									</w2:column>
									<w2:column removeBorderStyle="false" width="100" inputType="text" style="height:20px" id="column8"
										value="운전자명" blockSelect="false" displayMode="label">
									</w2:column>
									<w2:column removeBorderStyle="false" width="100" inputType="text" style="height:40px;" id="column18"
										value="차량번호" blockSelect="false" displayMode="label" colSpan="" >
									</w2:column>
									<w2:column removeBorderStyle="false" width="150" inputType="text" style="height:40px;" id="column17"
										value="운수사" blockSelect="false" displayMode="label" colSpan="" >
									</w2:column>
									<w2:column removeBorderStyle="false" width="100" inputType="text" style="height:20px" id="column5"
										value="운전자명" blockSelect="false" displayMode="label">
									</w2:column>
									<w2:column removeBorderStyle="false" width="90" inputType="text" style="height:20px" id="column6"
										value="교대시각" blockSelect="false" displayMode="label">
									</w2:column>
								</w2:row>
							</w2:header>
							<w2:gBody style="" id="gBody1">
								<w2:row style="" id="row2">
									<w2:column removeBorderStyle="false" width="70" inputType="text" style="height:20px" id="OPER_DT"
										value="" blockSelect="false" displayMode="label" readOnly="true">
									</w2:column>
									<w2:column removeBorderStyle="false" width="80" inputType="text" style="height:20px" id="ALLOC_NO"
										value="" blockSelect="false" displayMode="label" readOnly="true" disabled="true">
									</w2:column>
									<w2:column removeBorderStyle="false" width="50" inputType="select" style="height:20px" id="WAY_DIV"
										value="" blockSelect="false" displayMode="label" readOnly="" disabled="true">
									</w2:column>
									<w2:column removeBorderStyle="false" width="100" inputType="textImage" style="height:20px" id="VHC_NO"
										value="" blockSelect="false" displayMode="label" readOnly="" imageSrc="/cm/images/inc/btn_search.png" imageHeight="20"
										imageWidth="20">
									</w2:column>
									<w2:column removeBorderStyle="false" width="150" inputType="text" style="height:20px" id="COMP_NM"
										value="" blockSelect="false" displayMode="label" readOnly="" textAlign="left" disabled="true">
									</w2:column>
									<w2:column removeBorderStyle="false" width="100" inputType="textImage" style="height:20px" id="DRV_NM"
										value="" blockSelect="false" displayMode="label" readOnly="" imageSrc="/cm/images/inc/btn_search.png" imageHeight="20"
										imageWidth="20">
									</w2:column>
									<w2:column removeBorderStyle="false" width="100" inputType="textImage" style="height:20px" id="SEC_VHC_NO"
										value="" blockSelect="false" displayMode="label" readOnly="" imageSrc="/cm/images/inc/btn_search.png" imageHeight="20"
										imageWidth="20">
									</w2:column>
									<w2:column removeBorderStyle="false" width="150" inputType="text" style="height:20px" id="SEC_COMP_NM"
										value="" blockSelect="false" displayMode="label" readOnly="" textAlign="left" disabled="true">
									</w2:column>
									<w2:column removeBorderStyle="false" width="100" inputType="textImage" style="height:20px" id="SEC_DRV_NM" 
										value="" blockSelect="false" displayMode="label" readOnly="" textAlign="" imageSrc="/cm/images/inc/btn_search.png"
										imageHeight="20" imageWidth="20">
									</w2:column>
									<w2:column removeBorderStyle="false" width="100" inputType="text" style="height:20px" id="SEC_TRAN_TM"
										value="" blockSelect="false" displayMode="label" readOnly="" textAlign="" maxLength="5">
									</w2:column>
									<!-- <w2:column removeBorderStyle="false" width="100" inputType="textImage" style="height:20px"
										id="THR_DRV_NM" value="" blockSelect="false" displayMode="label" readOnly="" textAlign="" imageSrc="/cm/images/inc/btn_search.png"
										imageHeight="20" imageWidth="20">
									</w2:column>
									<w2:column removeBorderStyle="false" width="100" inputType="text" style="height:20px" id="THR_TRAN_TM"
										value="" blockSelect="false" displayMode="label" readOnly="" maxLength="5">
									</w2:column> -->
									<w2:column removeBorderStyle="false" width="100" inputType="text" style="height:20px" id=""
										value="" blockSelect="false" displayMode="label" readOnly="" maxLength="5">
									</w2:column>
								</w2:row>
							</w2:gBody>
						</w2:gridView>
					</xf:group>
				</xf:group><!-- pgm_detail -->
			</xf:group>
		</xf:group>
	</body>
</html>
